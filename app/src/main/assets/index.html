<html>
<head>

</head>
<body>
<h1>JsBridge Test</h1>

<div>
    <button id="j-invoke-java-method-1">j-invoke-java-method-1</button>
    <button id="j-invoke-java-method-2">j-invoke-java-method-2</button>
</div>

<script>
    if (location.href.startsWith('http')) {
        window.Proxy = {
            _callbacks: {},
            client_transact: function (server_method_name, server_method_params, client_callback) {
                console.log(server_method_name, server_method_params, client_callback);
                var invoke_info = {
                    "_server_method_name": server_method_name
                };
                if (client_callback) {
                    var callback_id = new Date().getTime();
                    this._callbacks[callback_id] = client_callback;
                    invoke_info['_client_callback'] = callback_id;
                }

                console.log(JSON.stringify(invoke_info), JSON.stringify(server_method_params));
            },
            client_transact: function (server_method_name, server_method_params, client_callback) {
                console.log(server_method_name, server_method_params, client_callback);
                var wrap = {
                    "_server_method_name": server_method_name,
                    "_server_method_params": server_method_params
                };
                if (client_callback) {
                    var callback_id = new Date().getTime();
                    this._callbacks[callback_id] = client_callback;
                    wrap['_client_callback'] = callback_id;
                }

                var marshalling = JSON.stringify(wrap);
                console.log(marshalling);
            },
            server_onTransact: function (to_be_marshalling) {
                console.log(to_be_marshalling);
                var marshalling = JSON.stringify(to_be_marshalling);
                console.log(marshalling);
            }
        };
    } else {
        window.Proxy = {
            _callbacks: {},
            client_transact: function (server_method_name, server_method_params, client_callback) {
                console.log(server_method_name, server_method_params, client_callback);
                var invoke_info = {
                    "_server_method_name": server_method_name
                };
                if (client_callback) {
                    var callback_id = new Date().getTime();
                    this._callbacks[callback_id] = client_callback;
                    invoke_info['_client_callback'] = callback_id;
                }

                console.log(JSON.stringify(invoke_info), JSON.stringify(server_method_params));
                JAVA_PROXY.onTransact(JSON.stringify(invoke_info), JSON.stringify(server_method_params));
            },
            server_onTransact: function (to_be_marshalling) {
                console.log(to_be_marshalling);
                var marshalling = JSON.stringify(to_be_marshalling);
                console.log(marshalling);
            }
        };
    }

    var sdk = {
        showPackageName: function (params) {
            var _server_method_name = 'showPackageName';
            var _server_method_params = params;
            window.Proxy.client_transact(_server_method_name, _server_method_params, null);
        },
        getUser: function (params) {
            var _server_method_name = 'getUser';
            var _server_method_params = params;
            var _client_callback = params;
            window.Proxy.client_transact(_server_method_name, _server_method_params, _client_callback);
        }
    };

    //server
    function server_onTransact(marshalling) {
        console.log(marshalling);
    }

    //client
    function _$(id) {
        return document.getElementById(id);
    }

    _$('j-invoke-java-method-1').addEventListener('click', function (e) {
        sdk.showPackageName({
            "success": function (data) {
                console.log('sdk.getPackageName,success', data);
            },
            "fail": function (error) {
                console.log('sdk.getPackageName,fail', data);
            }
        });
    }, false);

    _$('j-invoke-java-method-2').addEventListener('click', function (e) {
        sdk.getUser({
            "name_prefix": "standard_prefix",
            "success": function (user) {
                console.log('sdk.getUser,success', user);
            },
            "fail": function (error) {
                console.log('sdk.getUser,fail', data);
            }
        });
    }, false);


</script>
</body>
</html>